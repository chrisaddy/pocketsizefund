#!/usr/bin/env bash

# create a repository in ECR
# to store the model image

set -e

directory_name=$1

if [[ -z "$directory_name" ]]; then
    echo "valid directory name required:"
    echo ""
    ls -li exp | awk '{print $NF}' | tail -n +2
    echo ""
    exit 0
fi

directory_suffix=$2

if [[ -z "$directory_suffix" ]]; then
    echo "valid directory name required:"
    echo ""
    echo "train"
    echo "invoke"
    echo ""
    exit 0
fi

region=$(aws --profile default configure get region)

repository_name=$(python3 ./bin/helpers/rename_resource.py ${directory_name})-${directory_suffix}

AWS_PAGER="" aws ecr create-repository \
    --repository-name ${repository_name} \
    --region ${region} \
    --no-paginate

AWS_PAGER="" aws ecr put-lifecycle-policy \
    --repository-name ${repository_name} \
    --lifecycle-policy-text "file://bin/helpers/ecr_lifecycle_policy.json"