#!/usr/bin/env bash

# removes the stack from AWS

set -e

environment="development"
if [[ "$2" == "production" ]]; then
    environment="production"
fi

users_table=$(aws cloudformation describe-stacks \
    --stack-name pocketsizefund-${environment} \
    --query 'Stacks[0].Outputs[?OutputKey==`UsersTable`].OutputValue' \
    --output text)

python3 ./bin/helpers/download_users_table.py ${environment} ${users_table}

aws cloudformation delete-stack --stack-name pocketsizefund-${environment}