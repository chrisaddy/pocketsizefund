#!/usr/bin/env bash

# removes the stack from AWS

set -e

environment="development"
if [[ "$2" == "production" ]]; then
    environment="production"
fi

account_id=$(aws sts get-caller-identity --query 'Account' --output text)

aws dynamodb export-table-to-point-in-time \
    --table-arn arn:aws:dynamodb:us-east-1:$account_id:table/pocketsizefund-$environment-users \
    --s3-bucket pocketsizefund-artifacts \
    --s3-prefix users_table_data \
    --export-format DYNAMODB_JSON \
    --no-paginate

aws cloudformation delete-stack --stack-name pocketsizefund-$environment