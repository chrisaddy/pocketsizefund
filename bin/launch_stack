#!/usr/bin/env bash

# creates and starts up SAM resources in the
# AWS account

set -e

environment="development"
if [[ "$1" == "production" ]]; then
    environment="production"
fi

sam deploy \
    --no-confirm-changeset \
    --resolve-image-repos \
    --on-failure DELETE \
    --config-env $environment

aws dynamodb import-table \
    --s3-bucket-source S3Bucket=pocketsizefund-artifacts,S3KeyPrefix=users_table_data \
    --input-format DYNAMODB_JSON \
    --table-creation-parameters file://users_table_parameters.json \
    --no-paginate
